{"ast":null,"code":"import _toConsumableArray from\"/Users/tunny2406/Documents/VST/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import React,{useEffect}from'react';import'./addToHomeScreen.scss';import DEFAULT_CONFIGURATION from'./addToHomeScreenConfiguration.json';export default function AddToHomeScreen(props){var DEFAULT_PROMPT={title:'Do you want to install this application on your homescreen?',cancelMsg:'Not now',installMsg:'Install',guidanceCancelMsg:'Close',src:'images/logos/default/StoreLogo.png'};var DEFAULT_SESSION={lastDisplayTime:0,// last time we displayed the message\nreturningVisitor:false,// is this the first time you visit\ndisplayCount:0,// number of times the message has been shown\noptedOut:false,// has the user opted out\nadded:false,// has been actually added to the home screen\npageViews:0};var configuration=buildConfiguration();doLog(\"final configuration: \".concat(JSON.stringify(configuration)));var session={};var platform={};var guidanceTargetUrls=[];var isAthDialogShown=false;var showNativePrompt=false;var canPromptState;var beforeInstallPromptEvent;var autoHideTimer;useEffect(initialize,[]);function initialize(){if('onbeforeinstallprompt'in window){doLog('add beforeinstallprompt listener');window.addEventListener('beforeinstallprompt',handleBeforeInstallPrompt);showNativePrompt=true;}if('onappinstalled'in window){window.addEventListener('appinstalled',function(evt){doLog('A2HS installed');session.added=true;updateSession();if(configuration.onInstall){configuration.onInstall.call(this);}});}checkPlatform();var sessionString=window.localStorage.getItem(configuration.appId);session=sessionString?JSON.parse(sessionString):DEFAULT_SESSION;if(session&&session.added){// there is nothing to do if app was already added to home screen\nreturn;}if('serviceWorker'in navigator){var manifestElement=document.querySelector('[rel=\\'manifest\\']');if(!manifestElement){doLog('no manifest file');platform.isCompatible=false;}setTimeout(function(){// we wait 1 sec until we execute this because sometimes the browser needs a little time to register the service worker\nnavigator.serviceWorker.getRegistration().then(afterServiceWorkerCheck);buildGuidanceURLs(configuration.customPromptPlatformDependencies);},1000);}else{afterServiceWorkerCheck({});}}function buildConfiguration(){var options=Object.assign({},DEFAULT_CONFIGURATION,props);options.customPromptContent=Object.assign({},DEFAULT_CONFIGURATION.customPromptContent,props.customPromptContent);options.customPromptElements=Object.assign({},DEFAULT_CONFIGURATION.customPromptElements,props.customPromptElements);options.customPromptPlatformDependencies=Object.assign({},DEFAULT_CONFIGURATION.customPromptPlatformDependencies,props.customPromptPlatformDependencies);for(var key in DEFAULT_CONFIGURATION.customPromptPlatformDependencies){if(DEFAULT_CONFIGURATION.customPromptPlatformDependencies.hasOwnProperty(key)){if(props.customPromptPlatformDependencies){options.customPromptPlatformDependencies[key]=Object.assign({},DEFAULT_CONFIGURATION.customPromptPlatformDependencies[key],props.customPromptPlatformDependencies[key]);}else{options.customPromptPlatformDependencies[key]=DEFAULT_CONFIGURATION.customPromptPlatformDependencies[key];}}}return options;}function buildGuidanceURLs(prompts){for(var key in prompts){if(prompts.hasOwnProperty(key)){var target=prompts[key].targetUrl;doLog('building guidance urls: '+key+target?'/'+target:'');if(target){guidanceTargetUrls.push(target);}}}}// show hint images for browsers without native prompt\n/*\n   * Currently:\n   *  iOS Safari\n   *  FireFox Android\n   *  Samsung Android\n   *  Opera Android\n   */function showPlatformGuidance(skipNative){var target=getPlatform(skipNative);doLog('showing platform guidance for: '+target);var athWrapper=document.querySelector(\".\".concat(configuration.customPromptElements.container));if(athWrapper){if(autoHideTimer){clearTimeout(autoHideTimer);}if(!skipNative&&target==='native'&&beforeInstallPromptEvent){closePrompt();triggerNativePrompt();}else{var promptTarget=Object.assign({},DEFAULT_PROMPT,configuration.customPromptContent,configuration.customPromptPlatformDependencies[target]);if(promptTarget.targetUrl){document.location.replace(promptTarget.targetUrl);}else{if(promptTarget.images&&promptTarget.images.length>0){var promptDialogBannerBody=athWrapper.querySelector(\".\".concat(configuration.customPromptElements.banner));var promptDialogGuidanceBody=athWrapper.querySelector(\".\".concat(configuration.customPromptElements.guidance));var promptDialogGuidanceImageCell=athWrapper.querySelector(\".\".concat(configuration.customPromptElements.guidanceImageCell));var promptDialogGuidanceCancelButton=athWrapper.querySelector(\".\".concat(configuration.customPromptElements.guidanceCancelButton));promptDialogBannerBody.classList.add(configuration.hideClass);promptDialogGuidanceBody.classList.add(configuration.showClass);for(var index=0;index<promptTarget.images.length;index++){var img=new Image();img.src=promptTarget.images[index].src;img.alt=promptTarget.images[index].alt;if(promptTarget.images[index].classes){var _img$classList;(_img$classList=img.classList).add.apply(_img$classList,_toConsumableArray(promptTarget.images[index].classes));}promptDialogGuidanceImageCell.appendChild(img);}if(promptDialogGuidanceCancelButton){promptDialogGuidanceCancelButton.addEventListener('click',cancelPrompt);promptDialogGuidanceCancelButton.classList.remove(configuration.hideClass);promptDialogGuidanceCancelButton.innerText=promptTarget.guidanceCancelMsg!=null?promptTarget.guidanceCancelMsg:promptTarget.action&&promptTarget.action.guidanceCancel?promptTarget.action.guidanceCancel:'';}}if(!isVisible(athWrapper)){var _athWrapper$classList;(_athWrapper$classList=athWrapper.classList).add.apply(_athWrapper$classList,_toConsumableArray(promptTarget.showClasses));athWrapper.classList.remove(configuration.hideClass);}var hideAfter=configuration.lifespan>=10?configuration.lifespan:10;autoHideTimer=setTimeout(autoHide,hideAfter*1000);}}}}function isVisible(element){var dimensions=element.getBoundingClientRect();return dimensions.width!==0&&dimensions.height!==0;}function afterServiceWorkerCheck(serviceWorker){if(!serviceWorker){doLog('no service worker');platform.isCompatible=false;}doLog('service worker found - increasing page views');session.pageViews+=1;updateSession();// override defaults that are dependent on each other\nif(configuration&&configuration.debug&&typeof configuration.activateLogging==='undefined'){configuration.activateLogging=true;}// setup the debug environment\nif(configuration.debug){platform.isCompatible=true;}if(configuration.onInit){configuration.onInit.call(this);}doLog('decide to show: autoStart: '+configuration.startAutomatically+' ### beforeInstallPromptEvent: '+beforeInstallPromptEvent+' ### showNativePrompt: '+showNativePrompt);if(configuration.startAutomatically&&!!beforeInstallPromptEvent){doLog('autoStart - displaying call-out');show();}else if(!showNativePrompt){doLog('not showing native prompt - displaying call-out');show();}else{doLog('did decide to show nothing');}}function doLog(logString){if(configuration.activateLogging){console.log('Add to Homescreen: '+logString);}}function updateSession(){window.localStorage.setItem(configuration.appId,JSON.stringify(session));}function checkPlatform(){// browser info and capability\nvar userAgent=window.navigator.userAgent;doLog('checking platform - found user agent: '+userAgent);platform.isIDevice=/iphone|ipod|ipad/i.test(userAgent);platform.isSamsung=/Samsung/i.test(userAgent);platform.isFireFox=/Firefox/i.test(userAgent);platform.isOpera=/opr/i.test(userAgent);platform.isEdge=/edg/i.test(userAgent);// Opera & FireFox only Trigger on Android\nif(platform.isFireFox){platform.isFireFox=/android/i.test(userAgent);}if(platform.isOpera){platform.isOpera=/android/i.test(userAgent);}platform.isChromium='onbeforeinstallprompt'in window;platform.isInWebAppiOS=window.navigator.standalone===true;platform.isInWebAppChrome=window.matchMedia('(display-mode: standalone)').matches;platform.isMobileSafari=platform.isIDevice&&userAgent.indexOf('Safari')>-1&&userAgent.indexOf('CriOS')<0;platform.isStandalone=platform.isInWebAppiOS||platform.isInWebAppChrome;platform.isiPad=platform.isMobileSafari&&userAgent.indexOf('iPad')>-1;platform.isiPhone=platform.isMobileSafari&&userAgent.indexOf('iPad')===-1;platform.isCompatible=platform.isChromium||platform.isMobileSafari||platform.isSamsung||platform.isFireFox||platform.isOpera;}function getPlatform(native){if(configuration.debug&&typeof configuration.debug==='string'){return configuration.debug;}if(platform.isChromium&&native===undefined){return'native';}else if(platform.isFireFox){return'firefox';}else if(platform.isiPad){return'ipad';}else if(platform.isiPhone){return'iphone';}else if(platform.isOpera){return'opera';}else if(platform.isSamsung){return'samsung';}else if(platform.isEdge){return'edge';}else if(platform.isChromium){return'chromium';}else{return'';}}function handleBeforeInstallPrompt(event){event.preventDefault();doLog('capturing the native A2HS prompt');beforeInstallPromptEvent=event;delayedShow();}function delayedShow(){setTimeout(performShow,configuration.startDelay*1000+500);}function show(){// message already on screen\nif(isAthDialogShown){doLog('not displaying call-out because already shown on screen');return;}isAthDialogShown=true;if(document.readyState==='interactive'||document.readyState==='complete'){delayedShow();}else{document.onreadystatechange=function(){if(document.readyState==='complete'){delayedShow();}};}}function performShow(){if(canPrompt()){if(beforeInstallPromptEvent&&!configuration.mustShowCustomPrompt){doLog('show native prompt');triggerNativePrompt();}else{var target=getPlatform();var athWrapper=document.querySelector(\".\".concat(configuration.customPromptElements.container));doLog(\"show generic prompt for platform \".concat(target));if(athWrapper&&!session.optedOut){athWrapper.classList.remove(configuration.hideClass);var promptTarget=Object.assign({},DEFAULT_PROMPT,configuration.customPromptContent,configuration.customPromptPlatformDependencies[target]);if(promptTarget.showClasses){promptTarget.showClasses=promptTarget.showClasses.concat(configuration.showClasses);}else{promptTarget.showClasses=configuration.showClasses;}for(var index=0;index<promptTarget.showClasses.length;index++){athWrapper.classList.add(promptTarget.showClasses[index]);}var promptDialogTitle=athWrapper.querySelector(\".\".concat(configuration.customPromptElements.title));var promptDialogLogo=athWrapper.querySelector(\".\".concat(configuration.customPromptElements.logo));var promptDialogCancelButton=athWrapper.querySelector(\".\".concat(configuration.customPromptElements.cancelButton));var promptDialogInstallButton=athWrapper.querySelector(\".\".concat(configuration.customPromptElements.installButton));if(promptDialogTitle&&promptTarget.title){promptDialogTitle.innerText=promptTarget.title;}if(promptDialogLogo){if(promptTarget.src){promptDialogLogo.src=promptTarget.src;promptDialogLogo.alt=promptTarget.title||'Install application';}else{promptDialogLogo.remove();}}if(promptDialogInstallButton){promptDialogInstallButton.addEventListener('click',handleInstall);promptDialogInstallButton.classList.remove(configuration.hideClass);promptDialogInstallButton.innerText=promptTarget.installMsg!=null?promptTarget.installMsg:promptTarget.action&&promptTarget.action.ok?promptTarget.action.ok:'';}if(promptDialogCancelButton){promptDialogCancelButton.addEventListener('click',cancelPrompt);promptDialogCancelButton.classList.remove(configuration.hideClass);promptDialogCancelButton.innerText=promptTarget.cancelMsg!=null?promptTarget.cancelMsg:promptTarget.action&&promptTarget.action.cancel?promptTarget.action.cancel:'';}}if(configuration.lifespan&&configuration.lifespan>0){autoHideTimer=setTimeout(autoHide,configuration.lifespan*1000);}}// fire the custom onShow event\nif(configuration.onShow){configuration.onShow.call(this);}// increment the display count\nsession.lastDisplayTime=Date.now();session.displayCount++;updateSession();}}function canPrompt(){if(canPromptState!==undefined){// already evaluated the situation, so don't do it again\ndoLog('canPrompt() already evaluated: '+canPromptState.toString());return canPromptState;}canPromptState=false;if(configuration.customCriteria!==null){var passCustom=typeof configuration.customCriteria==='function'?configuration.customCriteria():!!configuration.customCriteria;if(!passCustom){doLog('not displaying call-out because a custom criteria was not met.');return false;}}// using a double negative here to detect if service workers are not supported\n// if not then don't bother asking to add to install the PWA\nif(!('serviceWorker'in navigator)){doLog('not displaying call-out because service workers are not supported');return false;}// the device is not supported\nif(!platform.isCompatible){doLog('not displaying call-out because device not supported');doLog('platform: '+JSON.stringify(platform));return false;}var now=Date.now();var lastDisplayTime=session.lastDisplayTime;// we obey the display pace (prevent the message to popup too often)\nif(now-lastDisplayTime<configuration.displayPace*60000){doLog('not displaying call-out because displayed recently');return false;}// obey the maximum number of display count\nif(configuration.maxDisplayCount&&session.displayCount>=configuration.maxDisplayCount){doLog('not displaying call-out because displayed too many times already');return false;}// check if this is a valid location\n// TODO: should include at least the home page here\n// by default all pages are valid, which can cause issues on iOS\n// TODO: maybe trigger a redirect back to the home page for iOS\nvar isValidLocation=!configuration.validLocation.length;for(var i=configuration.validLocation.length;i--;){if(configuration.validLocation[i].test(document.location.href)){isValidLocation=true;break;}}if(!isValidLocation){doLog('not displaying call-out because not a valid location');return false;}var isGuidanceURL=false;for(var _i=guidanceTargetUrls.length;_i--;){if(document.location.href.indexOf(guidanceTargetUrls[_i])>-1){isGuidanceURL=true;break;}}if(isGuidanceURL){doLog('not displaying call-out because this is a guidance URL');return false;}if(session.pageViews<configuration.minPageViews){doLog('not displaying call-out because not enough visits');return false;}// critical errors:\nif(session.optedOut){doLog('not displaying call-out because user opted out');return false;}if(session.added){doLog('not displaying call-out because already added to the home screen');return false;}// check if the app is in stand alone mode\n// this applies to iOS\nif(platform.isStandalone){// execute the onAdd event if we haven't already\nif(!session.added){session.added=true;updateSession();if(configuration.onAdd){configuration.onAdd.call(this);}}doLog('not displaying call-out because in standalone mode');return false;}// check if this is a returning visitor\nif(!session.returningVisitor){session.returningVisitor=true;updateSession();// we do not show the message if this is your first visit\nif(configuration.skipFirstVisit){doLog('not displaying call-out because skipping first visit');return false;}}canPromptState=true;return true;}/* displays native A2HS prompt & stores results */function triggerNativePrompt(){return beforeInstallPromptEvent.prompt().then(function(){// Wait for the user to respond to the prompt\nreturn beforeInstallPromptEvent.userChoice;}).then(function(choiceResult){session.added=choiceResult.outcome==='accepted';if(session.added){doLog('user accepted the A2HS prompt');if(configuration.onAdd){configuration.onAdd();}}else{if(configuration.onCancel){configuration.onCancel();}session.optedOut=true;doLog('user dismissed the A2HS prompt');}updateSession();beforeInstallPromptEvent=null;}).catch(function(err){doLog(err.message);if(err.message.indexOf('user gesture')>-1){configuration.mustShowCustomPrompt=true;delayedShow();}else if(err.message.indexOf('The app is already installed')>-1){doLog(err.message);session.added=true;updateSession();}else{doLog(err);return err;}});}function cancelPrompt(event){event.preventDefault();if(configuration.onCancel){configuration.onCancel();}closePrompt();return false;}function closePrompt(){var athWrapper=document.querySelector(\".\".concat(configuration.customPromptElements.container));if(athWrapper){var _athWrapper$classList2;var target=getPlatform();var promptTarget=configuration.customPromptPlatformDependencies[target];promptTarget.showClasses=promptTarget.showClasses.concat(configuration.showClasses);(_athWrapper$classList2=athWrapper.classList).remove.apply(_athWrapper$classList2,_toConsumableArray(promptTarget.showClasses));}}function handleInstall(){if(configuration.onInstall){configuration.onInstall();}if(beforeInstallPromptEvent&&(!configuration.debug||getPlatform()==='native')){closePrompt();triggerNativePrompt();}else{showPlatformGuidance(true);}return false;}function autoHide(){var athWrapper=document.querySelector(\".\".concat(configuration.customPromptElements.container));closePrompt();if(athWrapper){athWrapper.classList.add(configuration.hideClass);}}return/*#__PURE__*/React.createElement(\"div\",{className:\"\".concat(configuration.customPromptElements.container,\" \").concat(configuration.customPromptElements.containerAddOns)},/*#__PURE__*/React.createElement(\"div\",{className:\"\".concat(configuration.customPromptElements.banner,\" \").concat(configuration.customPromptElements.bannerAddOns)},/*#__PURE__*/React.createElement(\"div\",{className:\"\".concat(configuration.customPromptElements.logoCell,\" \").concat(configuration.customPromptElements.logoCellAddOns)},/*#__PURE__*/React.createElement(\"img\",{alt:\"Application Logo\",className:\"\".concat(configuration.customPromptElements.logo,\" \").concat(configuration.customPromptElements.logoAddOns)})),/*#__PURE__*/React.createElement(\"div\",{className:\"\".concat(configuration.customPromptElements.titleCell,\" \").concat(configuration.customPromptElements.titleCellAddOns)},/*#__PURE__*/React.createElement(\"div\",{className:\"\".concat(configuration.customPromptElements.title,\" \").concat(configuration.customPromptElements.titleAddOns)})),/*#__PURE__*/React.createElement(\"div\",{className:\"\".concat(configuration.customPromptElements.cancelButtonCell,\" \").concat(configuration.customPromptElements.cancelButtonCellAddOns)},/*#__PURE__*/React.createElement(\"button\",{className:\"\".concat(configuration.customPromptElements.cancelButton,\" \").concat(configuration.customPromptElements.cancelButtonAddOns)},\"Not Now\")),/*#__PURE__*/React.createElement(\"div\",{className:\"\".concat(configuration.customPromptElements.installButtonCell,\" \").concat(configuration.customPromptElements.installButtonCellAddOns)},/*#__PURE__*/React.createElement(\"button\",{className:\"\".concat(configuration.customPromptElements.installButton,\" \").concat(configuration.customPromptElements.installButtonAddOns)},\"Install\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"\".concat(configuration.customPromptElements.guidance,\" \").concat(configuration.customPromptElements.guidanceAddOns)},/*#__PURE__*/React.createElement(\"div\",{className:\"\".concat(configuration.customPromptElements.guidanceImageCell,\" \").concat(configuration.customPromptElements.guidanceImageCellAddOns)}),/*#__PURE__*/React.createElement(\"div\",{className:\"\".concat(configuration.customPromptElements.cancelButtonCell,\" \").concat(configuration.customPromptElements.cancelButtonCellAddOns)},/*#__PURE__*/React.createElement(\"button\",{className:\"\".concat(configuration.customPromptElements.guidanceCancelButton,\" \").concat(configuration.customPromptElements.guidanceCancelButtonAddOns)},\"Close\"))));}","map":{"version":3,"sources":["/Users/tunny2406/Documents/VST/src/addto/AddToHomeScreen.js"],"names":["React","useEffect","DEFAULT_CONFIGURATION","AddToHomeScreen","props","DEFAULT_PROMPT","title","cancelMsg","installMsg","guidanceCancelMsg","src","DEFAULT_SESSION","lastDisplayTime","returningVisitor","displayCount","optedOut","added","pageViews","configuration","buildConfiguration","doLog","JSON","stringify","session","platform","guidanceTargetUrls","isAthDialogShown","showNativePrompt","canPromptState","beforeInstallPromptEvent","autoHideTimer","initialize","window","addEventListener","handleBeforeInstallPrompt","evt","updateSession","onInstall","call","checkPlatform","sessionString","localStorage","getItem","appId","parse","navigator","manifestElement","document","querySelector","isCompatible","setTimeout","serviceWorker","getRegistration","then","afterServiceWorkerCheck","buildGuidanceURLs","customPromptPlatformDependencies","options","Object","assign","customPromptContent","customPromptElements","key","hasOwnProperty","prompts","target","targetUrl","push","showPlatformGuidance","skipNative","getPlatform","athWrapper","container","clearTimeout","closePrompt","triggerNativePrompt","promptTarget","location","replace","images","length","promptDialogBannerBody","banner","promptDialogGuidanceBody","guidance","promptDialogGuidanceImageCell","guidanceImageCell","promptDialogGuidanceCancelButton","guidanceCancelButton","classList","add","hideClass","showClass","index","img","Image","alt","classes","appendChild","cancelPrompt","remove","innerText","action","guidanceCancel","isVisible","showClasses","hideAfter","lifespan","autoHide","element","dimensions","getBoundingClientRect","width","height","debug","activateLogging","onInit","startAutomatically","show","logString","console","log","setItem","userAgent","isIDevice","test","isSamsung","isFireFox","isOpera","isEdge","isChromium","isInWebAppiOS","standalone","isInWebAppChrome","matchMedia","matches","isMobileSafari","indexOf","isStandalone","isiPad","isiPhone","native","undefined","event","preventDefault","delayedShow","performShow","startDelay","readyState","onreadystatechange","canPrompt","mustShowCustomPrompt","concat","promptDialogTitle","promptDialogLogo","logo","promptDialogCancelButton","cancelButton","promptDialogInstallButton","installButton","handleInstall","ok","cancel","onShow","Date","now","toString","customCriteria","passCustom","displayPace","maxDisplayCount","isValidLocation","validLocation","i","href","isGuidanceURL","minPageViews","onAdd","skipFirstVisit","prompt","userChoice","choiceResult","outcome","onCancel","catch","err","message","containerAddOns","bannerAddOns","logoCell","logoCellAddOns","logoAddOns","titleCell","titleCellAddOns","titleAddOns","cancelButtonCell","cancelButtonCellAddOns","cancelButtonAddOns","installButtonCell","installButtonCellAddOns","installButtonAddOns","guidanceAddOns","guidanceImageCellAddOns","guidanceCancelButtonAddOns"],"mappings":"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","sourcesContent":["import PropTypes from 'prop-types';\nimport React, { useEffect } from 'react';\n\nimport './addToHomeScreen.scss';\nimport DEFAULT_CONFIGURATION from './addToHomeScreenConfiguration.json';\n\nexport default function AddToHomeScreen(props) {\n\n  const DEFAULT_PROMPT = {\n    title: 'Do you want to install this application on your homescreen?',\n    cancelMsg: 'Not now',\n    installMsg: 'Install',\n    guidanceCancelMsg: 'Close',\n    src: 'images/logos/default/StoreLogo.png'\n  };\n\n  const DEFAULT_SESSION = {\n    lastDisplayTime: 0, // last time we displayed the message\n    returningVisitor: false, // is this the first time you visit\n    displayCount: 0, // number of times the message has been shown\n    optedOut: false, // has the user opted out\n    added: false, // has been actually added to the home screen\n    pageViews: 0\n  };\n\n  let configuration = buildConfiguration();\n\n  doLog(`final configuration: ${ JSON.stringify(configuration) }`);\n\n  let session = {};\n  let platform = {};\n  let guidanceTargetUrls = [];\n  let isAthDialogShown = false;\n  let showNativePrompt = false;\n\n  let canPromptState;\n  let beforeInstallPromptEvent;\n  let autoHideTimer;\n\n  useEffect(initialize, []);\n\n  function initialize() {\n    if ('onbeforeinstallprompt' in window) {\n      doLog('add beforeinstallprompt listener');\n      window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n      showNativePrompt = true;\n\n    }\n    if ('onappinstalled' in window) {\n      window.addEventListener('appinstalled', function (evt) {\n        doLog('A2HS installed');\n        session.added = true;\n        updateSession();\n        if (configuration.onInstall) {\n          configuration.onInstall.call(this);\n        }\n      });\n\n    }\n\n    checkPlatform();\n\n    let sessionString = window.localStorage.getItem(configuration.appId);\n    session = sessionString ? JSON.parse(sessionString) : DEFAULT_SESSION;\n    if (session && session.added) {\n      // there is nothing to do if app was already added to home screen\n      return;\n    }\n\n    if ('serviceWorker' in navigator) {\n      let manifestElement = document.querySelector('[rel=\\'manifest\\']');\n      if (!manifestElement) {\n        doLog('no manifest file');\n        platform.isCompatible = false;\n      }\n      setTimeout(function () {\n        // we wait 1 sec until we execute this because sometimes the browser needs a little time to register the service worker\n        navigator.serviceWorker.getRegistration().then(afterServiceWorkerCheck);\n        buildGuidanceURLs(configuration.customPromptPlatformDependencies);\n      }, 1000);\n    } else {\n      afterServiceWorkerCheck({});\n    }\n\n  }\n\n  function buildConfiguration() {\n    let options = Object.assign({}, DEFAULT_CONFIGURATION, props);\n\n    options.customPromptContent = Object.assign({}, DEFAULT_CONFIGURATION.customPromptContent, props.customPromptContent);\n    options.customPromptElements = Object.assign({}, DEFAULT_CONFIGURATION.customPromptElements, props.customPromptElements);\n    options.customPromptPlatformDependencies = Object.assign({}, DEFAULT_CONFIGURATION.customPromptPlatformDependencies, props.customPromptPlatformDependencies);\n\n    for (let key in DEFAULT_CONFIGURATION.customPromptPlatformDependencies) {\n      if (DEFAULT_CONFIGURATION.customPromptPlatformDependencies.hasOwnProperty(key)) {\n        if (props.customPromptPlatformDependencies) {\n          options.customPromptPlatformDependencies[key] = Object.assign({}, DEFAULT_CONFIGURATION.customPromptPlatformDependencies[key], props.customPromptPlatformDependencies[key]);\n        } else {\n          options.customPromptPlatformDependencies[key] = DEFAULT_CONFIGURATION.customPromptPlatformDependencies[key];\n        }\n      }\n    }\n    return options;\n  }\n\n  function buildGuidanceURLs(prompts) {\n    for (let key in prompts) {\n      if (prompts.hasOwnProperty(key)) {\n        let target = prompts[key].targetUrl;\n\n        doLog('building guidance urls: ' + key + target ? '/' + target : '');\n        if (target) {\n          guidanceTargetUrls.push(target);\n        }\n      }\n    }\n  }\n\n  // show hint images for browsers without native prompt\n  /*\n   * Currently:\n   *  iOS Safari\n   *  FireFox Android\n   *  Samsung Android\n   *  Opera Android\n   */\n  function showPlatformGuidance(skipNative) {\n    let target = getPlatform(skipNative);\n    doLog('showing platform guidance for: ' + target);\n    let athWrapper = document.querySelector(`.${ configuration.customPromptElements.container }`);\n\n    if (athWrapper) {\n      if (autoHideTimer) {\n        clearTimeout(autoHideTimer);\n      }\n\n      if (!skipNative && target === 'native' && beforeInstallPromptEvent) {\n        closePrompt();\n        triggerNativePrompt();\n      } else {\n        let promptTarget = Object.assign({}, DEFAULT_PROMPT, configuration.customPromptContent, configuration.customPromptPlatformDependencies[target]);\n\n        if (promptTarget.targetUrl) {\n          document.location.replace(promptTarget.targetUrl);\n        } else {\n          if (promptTarget.images && promptTarget.images.length > 0) {\n            let promptDialogBannerBody = athWrapper.querySelector(`.${ configuration.customPromptElements.banner }`);\n            let promptDialogGuidanceBody = athWrapper.querySelector(`.${ configuration.customPromptElements.guidance }`);\n            let promptDialogGuidanceImageCell = athWrapper.querySelector(`.${ configuration.customPromptElements.guidanceImageCell }`);\n            let promptDialogGuidanceCancelButton = athWrapper.querySelector(`.${ configuration.customPromptElements.guidanceCancelButton }`);\n\n            promptDialogBannerBody.classList.add(configuration.hideClass);\n            promptDialogGuidanceBody.classList.add(configuration.showClass);\n\n            for (let index = 0; index < promptTarget.images.length; index++) {\n              let img = new Image();\n\n              img.src = promptTarget.images[index].src;\n              img.alt = promptTarget.images[index].alt;\n\n              if (promptTarget.images[index].classes) {\n                img.classList.add(...promptTarget.images[index].classes);\n              }\n              promptDialogGuidanceImageCell.appendChild(img);\n            }\n\n            if (promptDialogGuidanceCancelButton) {\n              promptDialogGuidanceCancelButton.addEventListener('click', cancelPrompt);\n              promptDialogGuidanceCancelButton.classList.remove(configuration.hideClass);\n              promptDialogGuidanceCancelButton.innerText = promptTarget.guidanceCancelMsg != null ? promptTarget.guidanceCancelMsg :\n                  ((promptTarget.action && promptTarget.action.guidanceCancel) ? promptTarget.action.guidanceCancel : '');\n            }\n          }\n          if (!isVisible(athWrapper)) {\n            athWrapper.classList.add(...promptTarget.showClasses);\n            athWrapper.classList.remove(configuration.hideClass);\n          }\n\n          let hideAfter = (configuration.lifespan >= 10) ? configuration.lifespan : 10;\n\n          autoHideTimer = setTimeout(autoHide, hideAfter * 1000);\n        }\n      }\n    }\n  }\n\n  function isVisible(element) {\n    let dimensions = element.getBoundingClientRect();\n    return dimensions.width !== 0 && dimensions.height !== 0;\n  }\n\n  function afterServiceWorkerCheck(serviceWorker) {\n    if (!serviceWorker) {\n      doLog('no service worker');\n      platform.isCompatible = false;\n    }\n    doLog('service worker found - increasing page views');\n\n    session.pageViews += 1;\n    updateSession();\n\n    // override defaults that are dependent on each other\n    if (configuration && configuration.debug && (typeof configuration.activateLogging === 'undefined')) {\n      configuration.activateLogging = true;\n    }\n\n    // setup the debug environment\n    if (configuration.debug) {\n      platform.isCompatible = true;\n    }\n\n    if (configuration.onInit) {\n      configuration.onInit.call(this);\n    }\n\n    doLog('decide to show: autoStart: ' + configuration.startAutomatically + ' ### beforeInstallPromptEvent: ' + beforeInstallPromptEvent + ' ### showNativePrompt: ' + showNativePrompt);\n    if (configuration.startAutomatically && !!beforeInstallPromptEvent) {\n      doLog('autoStart - displaying call-out');\n      show();\n    } else if (!showNativePrompt) {\n      doLog('not showing native prompt - displaying call-out');\n      show();\n    } else {\n      doLog('did decide to show nothing');\n    }\n\n  }\n\n  function doLog(logString) {\n    if (configuration.activateLogging) {\n      console.log('Add to Homescreen: ' + logString);\n    }\n  }\n\n  function updateSession() {\n    window.localStorage.setItem(configuration.appId, JSON.stringify(session));\n  }\n\n  function checkPlatform() {\n    // browser info and capability\n    let userAgent = window.navigator.userAgent;\n    doLog('checking platform - found user agent: ' + userAgent);\n\n    platform.isIDevice = (/iphone|ipod|ipad/i).test(userAgent);\n    platform.isSamsung = /Samsung/i.test(userAgent);\n    platform.isFireFox = /Firefox/i.test(userAgent);\n    platform.isOpera = /opr/i.test(userAgent);\n    platform.isEdge = /edg/i.test(userAgent);\n\n    // Opera & FireFox only Trigger on Android\n    if (platform.isFireFox) {\n      platform.isFireFox = /android/i.test(userAgent);\n    }\n\n    if (platform.isOpera) {\n      platform.isOpera = /android/i.test(userAgent);\n    }\n\n    platform.isChromium = ('onbeforeinstallprompt' in window);\n    platform.isInWebAppiOS = (window.navigator.standalone === true);\n    platform.isInWebAppChrome = (window.matchMedia('(display-mode: standalone)').matches);\n    platform.isMobileSafari = platform.isIDevice && userAgent.indexOf('Safari') > -1 && userAgent.indexOf('CriOS') < 0;\n    platform.isStandalone = platform.isInWebAppiOS || platform.isInWebAppChrome;\n    platform.isiPad = (platform.isMobileSafari && userAgent.indexOf('iPad') > -1);\n    platform.isiPhone = (platform.isMobileSafari && userAgent.indexOf('iPad') === -1);\n    platform.isCompatible = (platform.isChromium || platform.isMobileSafari ||\n        platform.isSamsung || platform.isFireFox || platform.isOpera);\n  }\n\n  function getPlatform(native) {\n    if (configuration.debug && typeof configuration.debug === 'string') {\n      return configuration.debug;\n    }\n\n    if (platform.isChromium && native === undefined) {\n      return 'native';\n    } else if (platform.isFireFox) {\n      return 'firefox';\n    } else if (platform.isiPad) {\n      return 'ipad';\n    } else if (platform.isiPhone) {\n      return 'iphone';\n    } else if (platform.isOpera) {\n      return 'opera';\n    } else if (platform.isSamsung) {\n      return 'samsung';\n    } else if (platform.isEdge) {\n      return 'edge';\n    } else if (platform.isChromium) {\n      return 'chromium';\n    } else {\n      return '';\n    }\n  }\n\n  function handleBeforeInstallPrompt(event) {\n    event.preventDefault();\n    doLog('capturing the native A2HS prompt');\n    beforeInstallPromptEvent = event;\n    delayedShow();\n  }\n\n  function delayedShow() {\n    setTimeout(performShow, configuration.startDelay * 1000 + 500);\n  }\n\n  function show() {\n    // message already on screen\n    if (isAthDialogShown) {\n      doLog('not displaying call-out because already shown on screen');\n      return;\n    }\n\n    isAthDialogShown = true;\n\n    if (document.readyState === 'interactive' || document.readyState === 'complete') {\n      delayedShow();\n    } else {\n      document.onreadystatechange = function () {\n        if (document.readyState === 'complete') {\n          delayedShow();\n        }\n      };\n    }\n  }\n\n  function performShow() {\n    if (canPrompt()) {\n      if (beforeInstallPromptEvent && !configuration.mustShowCustomPrompt) {\n        doLog('show native prompt');\n        triggerNativePrompt();\n      } else {\n        let target = getPlatform();\n        let athWrapper = document.querySelector(`.${ configuration.customPromptElements.container }`);\n\n        doLog(`show generic prompt for platform ${ target }`);\n        if (athWrapper && !session.optedOut) {\n          athWrapper.classList.remove(configuration.hideClass);\n\n          let promptTarget = Object.assign({}, DEFAULT_PROMPT, configuration.customPromptContent, configuration.customPromptPlatformDependencies[target]);\n\n          if (promptTarget.showClasses) {\n            promptTarget.showClasses = promptTarget.showClasses.concat(configuration.showClasses);\n          } else {\n            promptTarget.showClasses = configuration.showClasses;\n          }\n\n          for (let index = 0; index < promptTarget.showClasses.length; index++) {\n            athWrapper.classList.add(promptTarget.showClasses[index]);\n          }\n\n          let promptDialogTitle = athWrapper.querySelector(`.${ configuration.customPromptElements.title }`);\n          let promptDialogLogo = athWrapper.querySelector(`.${ configuration.customPromptElements.logo }`);\n          let promptDialogCancelButton = athWrapper.querySelector(`.${ configuration.customPromptElements.cancelButton }`);\n          let promptDialogInstallButton = athWrapper.querySelector(`.${ configuration.customPromptElements.installButton }`);\n\n          if (promptDialogTitle && promptTarget.title) {\n            promptDialogTitle.innerText = promptTarget.title;\n          }\n\n          if (promptDialogLogo) {\n            if (promptTarget.src) {\n              promptDialogLogo.src = promptTarget.src;\n              promptDialogLogo.alt = promptTarget.title || 'Install application';\n            } else {\n              promptDialogLogo.remove();\n            }\n          }\n\n          if (promptDialogInstallButton) {\n            promptDialogInstallButton.addEventListener('click', handleInstall);\n            promptDialogInstallButton.classList.remove(configuration.hideClass);\n            promptDialogInstallButton.innerText = promptTarget.installMsg != null ? promptTarget.installMsg :\n                ((promptTarget.action && promptTarget.action.ok) ? promptTarget.action.ok : '');\n          }\n\n          if (promptDialogCancelButton) {\n            promptDialogCancelButton.addEventListener('click', cancelPrompt);\n            promptDialogCancelButton.classList.remove(configuration.hideClass);\n            promptDialogCancelButton.innerText = promptTarget.cancelMsg != null ? promptTarget.cancelMsg :\n                ((promptTarget.action && promptTarget.action.cancel) ? promptTarget.action.cancel : '');\n          }\n        }\n\n        if (configuration.lifespan && configuration.lifespan > 0) {\n          autoHideTimer = setTimeout(autoHide, configuration.lifespan * 1000);\n        }\n      }\n\n      // fire the custom onShow event\n      if (configuration.onShow) {\n        configuration.onShow.call(this);\n      }\n\n      // increment the display count\n      session.lastDisplayTime = Date.now();\n      session.displayCount++;\n      updateSession();\n    }\n\n  }\n\n  function canPrompt() {\n    if (canPromptState !== undefined) {\n      // already evaluated the situation, so don't do it again\n      doLog('canPrompt() already evaluated: ' + canPromptState.toString());\n      return canPromptState;\n    }\n\n    canPromptState = false;\n\n    if (configuration.customCriteria !== null) {\n      let passCustom = typeof configuration.customCriteria === 'function' ? configuration.customCriteria() : !!configuration.customCriteria;\n\n      if (!passCustom) {\n        doLog('not displaying call-out because a custom criteria was not met.');\n        return false;\n      }\n    }\n\n    // using a double negative here to detect if service workers are not supported\n    // if not then don't bother asking to add to install the PWA\n    if (!('serviceWorker' in navigator)) {\n      doLog('not displaying call-out because service workers are not supported');\n      return false;\n    }\n\n    // the device is not supported\n    if (!platform.isCompatible) {\n      doLog('not displaying call-out because device not supported');\n      doLog('platform: ' + JSON.stringify(platform));\n      return false;\n    }\n\n    let now = Date.now();\n    let lastDisplayTime = session.lastDisplayTime;\n\n    // we obey the display pace (prevent the message to popup too often)\n    if (now - lastDisplayTime < configuration.displayPace * 60000) {\n      doLog('not displaying call-out because displayed recently');\n      return false;\n    }\n\n    // obey the maximum number of display count\n    if (configuration.maxDisplayCount && session.displayCount >= configuration.maxDisplayCount) {\n      doLog('not displaying call-out because displayed too many times already');\n      return false;\n    }\n\n    // check if this is a valid location\n    // TODO: should include at least the home page here\n    // by default all pages are valid, which can cause issues on iOS\n    // TODO: maybe trigger a redirect back to the home page for iOS\n    let isValidLocation = !configuration.validLocation.length;\n\n    for (let i = configuration.validLocation.length; i--;) {\n      if (configuration.validLocation[i].test(document.location.href)) {\n        isValidLocation = true;\n        break;\n      }\n    }\n\n    if (!isValidLocation) {\n      doLog('not displaying call-out because not a valid location');\n      return false;\n    }\n\n    let isGuidanceURL = false;\n\n    for (let i = guidanceTargetUrls.length; i--;) {\n      if (document.location.href.indexOf(guidanceTargetUrls[i]) > -1) {\n        isGuidanceURL = true;\n        break;\n      }\n    }\n\n    if (isGuidanceURL) {\n      doLog('not displaying call-out because this is a guidance URL');\n      return false;\n    }\n\n    if (session.pageViews < configuration.minPageViews) {\n      doLog('not displaying call-out because not enough visits');\n      return false;\n    }\n\n    // critical errors:\n    if (session.optedOut) {\n      doLog('not displaying call-out because user opted out');\n      return false;\n    }\n\n    if (session.added) {\n      doLog('not displaying call-out because already added to the home screen');\n      return false;\n    }\n\n    // check if the app is in stand alone mode\n    // this applies to iOS\n    if (platform.isStandalone) {\n\n      // execute the onAdd event if we haven't already\n      if (!session.added) {\n        session.added = true;\n        updateSession();\n\n        if (configuration.onAdd) {\n          configuration.onAdd.call(this);\n        }\n      }\n\n      doLog('not displaying call-out because in standalone mode');\n      return false;\n    }\n\n    // check if this is a returning visitor\n    if (!session.returningVisitor) {\n      session.returningVisitor = true;\n      updateSession();\n\n      // we do not show the message if this is your first visit\n      if (configuration.skipFirstVisit) {\n        doLog('not displaying call-out because skipping first visit');\n        return false;\n      }\n    }\n\n    canPromptState = true;\n    return true;\n  }\n\n  /* displays native A2HS prompt & stores results */\n  function triggerNativePrompt() {\n    return beforeInstallPromptEvent.prompt()\n        .then(function () {\n          // Wait for the user to respond to the prompt\n          return beforeInstallPromptEvent.userChoice;\n        })\n        .then(function (choiceResult) {\n          session.added = (choiceResult.outcome === 'accepted');\n\n          if (session.added) {\n            doLog('user accepted the A2HS prompt');\n            if (configuration.onAdd) {\n              configuration.onAdd();\n            }\n          } else {\n            if (configuration.onCancel) {\n              configuration.onCancel();\n            }\n            session.optedOut = true;\n            doLog('user dismissed the A2HS prompt');\n          }\n          updateSession();\n          beforeInstallPromptEvent = null;\n\n        })\n        .catch(function (err) {\n          doLog(err.message);\n\n          if (err.message.indexOf('user gesture') > -1) {\n            configuration.mustShowCustomPrompt = true;\n            delayedShow();\n          } else if (err.message.indexOf('The app is already installed') > -1) {\n            doLog(err.message);\n            session.added = true;\n            updateSession();\n          } else {\n            doLog(err);\n            return err;\n          }\n        });\n  }\n\n  function cancelPrompt(event) {\n    event.preventDefault();\n    if (configuration.onCancel) {\n      configuration.onCancel();\n    }\n    closePrompt();\n    return false;\n  }\n\n  function closePrompt() {\n    let athWrapper = document.querySelector(`.${ configuration.customPromptElements.container }`);\n    if (athWrapper) {\n      let target = getPlatform();\n      let promptTarget = configuration.customPromptPlatformDependencies[target];\n      promptTarget.showClasses = promptTarget.showClasses.concat(configuration.showClasses);\n      athWrapper.classList.remove(...promptTarget.showClasses);\n    }\n  }\n\n  function handleInstall() {\n    if (configuration.onInstall) {\n      configuration.onInstall();\n    }\n    if (beforeInstallPromptEvent && (!configuration.debug || getPlatform() === 'native')) {\n      closePrompt();\n      triggerNativePrompt();\n    } else {\n      showPlatformGuidance(true);\n    }\n    return false;\n  }\n\n  function autoHide() {\n    let athWrapper = document.querySelector(`.${ configuration.customPromptElements.container }`);\n\n    closePrompt();\n    if (athWrapper) {\n      athWrapper.classList.add(configuration.hideClass);\n    }\n  }\n\n  return (\n      <div className={ `${ configuration.customPromptElements.container } ${ configuration.customPromptElements.containerAddOns }` }>\n        <div className={ `${ configuration.customPromptElements.banner } ${ configuration.customPromptElements.bannerAddOns }` }>\n          <div className={ `${ configuration.customPromptElements.logoCell } ${ configuration.customPromptElements.logoCellAddOns }` }>\n            <img alt=\"Application Logo\" className={ `${ configuration.customPromptElements.logo } ${ configuration.customPromptElements.logoAddOns }` }/>\n          </div>\n          <div className={ `${ configuration.customPromptElements.titleCell } ${ configuration.customPromptElements.titleCellAddOns }` }>\n            <div className={ `${ configuration.customPromptElements.title } ${ configuration.customPromptElements.titleAddOns }` }/>\n          </div>\n          <div className={ `${ configuration.customPromptElements.cancelButtonCell } ${ configuration.customPromptElements.cancelButtonCellAddOns }` }>\n            <button className={ `${ configuration.customPromptElements.cancelButton } ${ configuration.customPromptElements.cancelButtonAddOns }` }>Not Now</button>\n          </div>\n          <div className={ `${ configuration.customPromptElements.installButtonCell } ${ configuration.customPromptElements.installButtonCellAddOns }` }>\n            <button className={ `${ configuration.customPromptElements.installButton } ${ configuration.customPromptElements.installButtonAddOns }` }>Install</button>\n          </div>\n        </div>\n        <div className={ `${ configuration.customPromptElements.guidance } ${ configuration.customPromptElements.guidanceAddOns }` }>\n          <div className={ `${ configuration.customPromptElements.guidanceImageCell } ${ configuration.customPromptElements.guidanceImageCellAddOns }` }/>\n          <div className={ `${ configuration.customPromptElements.cancelButtonCell } ${ configuration.customPromptElements.cancelButtonCellAddOns }` }>\n            <button className={ `${ configuration.customPromptElements.guidanceCancelButton } ${ configuration.customPromptElements.guidanceCancelButtonAddOns }` }>Close</button>\n          </div>\n        </div>\n      </div>\n  );\n}\n\nconst platformPropType = PropTypes.shape({\n  showClasses: PropTypes.arrayOf(PropTypes.string),\n  targetUrl: PropTypes.string,\n  images: PropTypes.arrayOf(PropTypes.shape({\n    src: PropTypes.string,\n    alt: PropTypes.string\n  })),\n  action: PropTypes.shape({\n    ok: PropTypes.string,\n    cancel: PropTypes.string,\n    guidanceCancel: PropTypes.string\n  })\n});\n\nAddToHomeScreen.propTypes = {\n  appId: PropTypes.string,\n  debug: PropTypes.string,\n  activateLogging: PropTypes.bool,\n  startAutomatically: PropTypes.bool,\n  skipFirstVisit: PropTypes.bool,\n  minPageViews: PropTypes.number,\n  startDelay: PropTypes.number,\n  lifespan: PropTypes.number,\n  displayPace: PropTypes.number,\n  mustShowCustomPrompt: PropTypes.bool,\n  maxDisplayCount: PropTypes.number,\n  validLocation: PropTypes.arrayOf(PropTypes.string),\n  onInit: PropTypes.func,\n  onShow: PropTypes.func,\n  onAdd: PropTypes.func,\n  onInstall: PropTypes.func,\n  onCancel: PropTypes.func,\n  showClasses: PropTypes.arrayOf(PropTypes.string),\n  showClass: PropTypes.string,\n  hideClass: PropTypes.string,\n  customCriteria: PropTypes.func,\n  customPromptContent: PropTypes.shape({\n    title: PropTypes.string,\n    src: PropTypes.string,\n    cancelMsg: PropTypes.string,\n    installMsg: PropTypes.string,\n    guidanceCancelMsg: PropTypes.string\n  }),\n  customPromptElements: PropTypes.shape({\n    container: PropTypes.string,\n    containerAddOns: PropTypes.string,\n    banner: PropTypes.string,\n    bannerAddOns: PropTypes.string,\n    logoCell: PropTypes.string,\n    logoCellAddOns: PropTypes.string,\n    logo: PropTypes.string,\n    logoAddOns: PropTypes.string,\n    titleCell: PropTypes.string,\n    titleCellAddOns: PropTypes.string,\n    title: PropTypes.string,\n    titleAddOns: PropTypes.string,\n    cancelButtonCell: PropTypes.string,\n    cancelButtonCellAddOns: PropTypes.string,\n    cancelButton: PropTypes.string,\n    cancelButtonAddOns: PropTypes.string,\n    installButtonCell: PropTypes.string,\n    installButtonCellAddOns: PropTypes.string,\n    installButton: PropTypes.string,\n    installButtonAddOns: PropTypes.string,\n    guidance: PropTypes.string,\n    guidanceAddOns: PropTypes.string,\n    guidanceImageCell: PropTypes.string,\n    guidanceImageCellAddOns: PropTypes.string,\n    guidanceCancelButton: PropTypes.string,\n    guidanceCancelButtonAddOns: PropTypes.string\n  }),\n  customPromptPlatformDependencies: PropTypes.shape({\n    native: platformPropType,\n    chromium: platformPropType,\n    edge: platformPropType,\n    iphone: platformPropType,\n    ipad: platformPropType,\n    firefox: platformPropType,\n    samsung: platformPropType,\n    opera: platformPropType\n  })\n};"]},"metadata":{},"sourceType":"module"}